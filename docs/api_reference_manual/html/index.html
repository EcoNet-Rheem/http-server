<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HTTP Server Middleware Library: Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="cypress_logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HTTP Server Middleware Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Overview </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This library provides the HTTP Server implementation that can work on the PSoC 6 MCU platforms with Wi-Fi connectivity.It supports RESTful methods such as GET, PUT, and POST for the client to communicate with this HTTP Server library.</p>
<h1><a class="anchor" id="section_features"></a>
Features</h1>
<p>Following are the features supported by this library:</p><ul>
<li>Secure [with TLS security] and non-secure modes of connection.</li>
<li>RESTful HTTP methods: GET, PUT, and POST.</li>
<li>Various resource content types such as HTML, Plain, and JSON.</li>
<li>Content payload greater than the MTU size using the Content-Length HTTP header. This feature is supported only for CY_RAW_DYNAMIC_URL_CONTENT and CY_DYNAMIC_URL_CONTENT content types.</li>
<li>Chunked encoding for GET and POST methods. <blockquote class="doxtable">
<p>Note: For POST requests, chunked encoding is supported only for data that is less than a single MTU; Content-Length headers are recommended for larger data. </p>
</blockquote>
</li>
<li>Server-Sent Events (SSE). SSE is a server push technology, enabling an HTTP client (for example, a browser or any device running an HTTP client) to receive automatic updates from the HTTP server via the HTTP connection.</li>
</ul>
<h1><a class="anchor" id="section_platforms"></a>
Supported Platforms</h1>
<ul>
<li><a href="https://www.cypress.com/documentation/development-kitsboards/psoc-6-wi-fi-bt-prototyping-kit-cy8cproto-062-4343w">PSoC 6 WiFi-BT Prototyping Kit (CY8CPROTO-062-4343W)</a></li>
<li><a href="https://www.cypress.com/documentation/development-kitsboards/psoc-6-wifi-bt-pioneer-kit-cy8ckit-062-wifi-bt">PSoC 6 WiFi-BT Pioneer Kit (CY8CKIT-062-WiFi-BT)</a></li>
<li><a href="https://www.cypress.com/documentation/development-kitsboards/psoc-62s2-wi-fi-bt-pioneer-kit-cy8ckit-062s2-43012">PSoC 62S2 Wi-Fi BT Pioneer Kit (CY8CKIT-062S2-43012)</a></li>
</ul>
<h1><a class="anchor" id="section_frameworks"></a>
Supported Frameworks</h1>
<p>This middleware library supports the following frameworks:</p><ul>
<li>AnyCloud Framework : AnyCloud is a FreeRTOS-based solution. HTTP server library uses the <a href="https://github.com/cypresssemiconductorco/abstraction-rtos">abstraction-rtos</a> library that provides the RTOS abstraction API and uses the <a href="https://github.com/cypresssemiconductorco/secure-sockets">secure-sockets</a> library for implementing socket functions.</li>
<li>Mbed framework: Mbed framework is a Mbed OS-based solution. HTTP server library uses the <a href="https://github.com/cypresssemiconductorco/abstraction-rtos">abstraction-rtos</a> library that provides RTOS abstraction API and uses the Mbed socket API for implementing socket functions.</li>
</ul>
<h1><a class="anchor" id="section_dependencies"></a>
Dependencies</h1>
<p>This HTTP Server library depends on the following libraries. All these libraries are included by default. </p>
<h2><a class="anchor" id="section_anycloud"></a>
AnyCloud</h2>
<ul>
<li><a href="https://github.com/cypresssemiconductorco/wifi-mw-core">Wi-Fi Middleware Core</a></li>
</ul>
<h2><a class="anchor" id="section_mbed"></a>
Mbed OS</h2>
<ul>
<li><a href="https://os.mbed.com/mbed-os/releases">Arm Mbed OS stack version 5.15.3</a></li>
<li><a href="https://github.com/cypresssemiconductorco/connectivity-utilities">Connectivity Utilities Library</a></li>
</ul>
<h1><a class="anchor" id="section_quick_start"></a>
Quick Start</h1>
<p>This library is supported on both AnyCloud and Mbed OS frameworks. The following section provides information on how to build the library in those framework </p>
<h2><a class="anchor" id="framework_1"></a>
AnyCloud</h2>
<ul>
<li>A set of pre-defined configuration files have been bundled with the wifi-mw-core library for FreeRTOS, lwIP, and mbed TLS. You should review the configuration and make the required adjustments. See the "Quick Start" section in <a href="https://github.com/cypresssemiconductorco/wifi-mw-core/blob/master/README.md">README.md</a></li>
<li>A set of COMPONENTS must be defined in the application's makefile for the HTTP Server Library. See the "Quick Start" section in <a href="https://github.com/cypresssemiconductorco/wifi-mw-core/blob/master/README.md">README.md</a></li>
<li>HTTP Server Library disables all the debug log messages by default. To enable log messages, the application must perform the following:<ol type="1">
<li>Add <code>ENABLE_HTTP_SERVER_LOGS</code> macro to the <em>DEFINES</em> in the code example's Makefile. The Makefile entry would look like as follows: <div class="fragment"><div class="line">DEFINES+=ENABLE_HTTP_SERVER_LOGS</div></div><!-- fragment --></li>
<li>Call the <code>cy_log_init()</code> function provided by the <em>cy-log</em> module. cy-log is part of the <em>connectivity-utilities</em> library. See <a href="https://cypresssemiconductorco.github.io/connectivity-utilities/api_reference_manual/html/group__logging__utils.html">connectivity-utilities library API documentation</a> for cy-log details.</li>
</ol>
</li>
<li>Define the below macro in application Makefile to configure maximum number of HTTP server resource : <div class="fragment"><div class="line"><a class="code" href="group__http__server__defines.html#ga6e47b484776a72216039a2af358bcedc">MAX_NUMBER_OF_HTTP_SERVER_RESOURCES</a></div></div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="framework_2"></a>
Mbed OS</h2>
<ul>
<li>HTTP Server Library disables all the debug log messages by default. To enable log messages, the application must perform the following:<ol type="1">
<li>Add <code>ENABLE_HTTP_SERVER_LOGS</code> macro to the <em>DEFINES</em> in the code example's JSON file. The JSON file entry would look like as follows: <div class="fragment"><div class="line"><span class="stringliteral">&quot;macros&quot;</span>: [<span class="stringliteral">&quot;ENABLE_HTTP_SERVER_LOGS&quot;</span>],</div></div><!-- fragment --></li>
<li>Call the <code>cy_log_init()</code> function provided by the <em>cy-log</em> module. cy-log is part of the <em>connectivity-utilities</em> library. See <a href="https://cypresssemiconductorco.github.io/connectivity-utilities/api_reference_manual/html/group__logging__utils.html">connectivity-utilities library API documentation</a> for cy-log details.</li>
</ol>
</li>
<li>Define the following macro in the application JSON file to configure the maximum number of HTTP server resources: <div class="fragment"><div class="line"><a class="code" href="group__http__server__defines.html#ga6e47b484776a72216039a2af358bcedc">MAX_NUMBER_OF_HTTP_SERVER_RESOURCES</a></div></div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="section_code_snippet"></a>
Code Snippets</h1>
<p>This section provides code snippets for this library on AnyCloud and Mbed OS frameworks. The code snippets given under the AnyCloud section uses C APIs, whereas the snippets given under Mbed OS use C++ Class to demonstrate the library usage. In general, the library features are tested on Mbed OS using C++ Class interface, and tested on AnyCloud using C APIs.</p><ul>
<li>AnyCloud - Snippets for HTTP Server create, start, stop, and delete (C implementation).</li>
<li>Mbed OS - Snippets for HTTP server create, start, stop, and delete (C++ implementation).</li>
</ul>
<h1><a class="anchor" id="section_code_snippet_AnyCloud"></a>
AnyCloud</h1>
<p>These code snippets demonstrate the initialization of the configuration structures required for the operation such as creating a secure or non-secure connection and registering a static or dynamic resource with the HTTP server. </p>
<h2><a class="anchor" id="snip1"></a>
Code Snippet 1: Creation and Initialization of Handle for Non-Secure HTTP Server</h2>
<p>Creates an HTTP server handle for a non-secure HTTP connection using the <a class="el" href="group__group__c__api__functions.html#ga1ca51f61222e3aed87c0a15955e2e269">cy_http_server_create</a> API function. </p><div class="fragment"><div class="line"><span class="preprocessor">#define MAKE_IPV4_ADDRESS(a, b, c, d)     ((((uint32_t) d) &lt;&lt; 24) | \</span></div><div class="line"><span class="preprocessor">                                          (((uint32_t) c) &lt;&lt; 16) | \</span></div><div class="line"><span class="preprocessor">                                          (((uint32_t) b) &lt;&lt; 8) |\</span></div><div class="line"><span class="preprocessor">                                          ((uint32_t) a))</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define SERVER_IP_ADDRESS                 MAKE_IPV4_ADDRESS(192, 168, 18, 9)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define HTTP_PORT         80</span></div><div class="line"><span class="preprocessor">#define MAX_SOCKETS       2</span></div><div class="line"></div><div class="line"><a class="code" href="group__http__server__struct.html#ga047ac1c7063077c58da4cc991ad3b1bf">cy_http_server_t</a>          httpSer;</div><div class="line">cy_network_interface_t    nw_interface;</div><div class="line">cy_socket_sockaddr_t      IP_address;</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> snippet_http_non_secure_create(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* Status variables for various operations */</span></div><div class="line">    cy_rslt_t TestRes = <a class="code" href="group__http__server__defines.html#gaf18faa0179a6087e4b03d9a81d02010e">CY_RSLT_ERROR</a>;</div><div class="line">    (void)TestRes;</div><div class="line">    <span class="comment">/* IP address of the server */</span></div><div class="line">    IP_address.ip_address.ip.v4 = SERVER_IP_ADDRESS;</div><div class="line">    IP_address.ip_address.version = CY_SOCKET_IP_VER_V4;</div><div class="line"></div><div class="line">    <span class="comment">/* Add the IP_address information to the network interface object */</span></div><div class="line">    nw_interface.object  = (<span class="keywordtype">void</span> *) &amp;IP_address;</div><div class="line">    nw_interface.type = CY_NW_INF_TYPE_WIFI;</div><div class="line"></div><div class="line">    <span class="comment">/* Initialize the network socket */</span></div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#ga74c8a85310d1537177f80adaef20cfd9">cy_http_server_network_init</a>();</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#ga1ca51f61222e3aed87c0a15955e2e269">cy_http_server_create</a>( &amp;nw_interface, HTTP_PORT, MAX_SOCKETS, NULL, &amp;httpSer );</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="snip2"></a>
Code Snippet 2:  Creation and Initialization of Handle for Secure HTTP Server</h2>
<p>Creates an HTTP server handle for a secure HTTP connection using the <a class="el" href="group__group__c__api__functions.html#ga1ca51f61222e3aed87c0a15955e2e269">cy_http_server_create</a> API function. </p><div class="fragment"><div class="line"><span class="preprocessor">#define MAKE_IPV4_ADDRESS(a, b, c, d)     ((((uint32_t) d) &lt;&lt; 24) | \</span></div><div class="line"><span class="preprocessor">                                          (((uint32_t) c) &lt;&lt; 16) | \</span></div><div class="line"><span class="preprocessor">                                          (((uint32_t) b) &lt;&lt; 8) |\</span></div><div class="line"><span class="preprocessor">                                          ((uint32_t) a))</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define SERVER_IP_ADDRESS                 MAKE_IPV4_ADDRESS(192, 168, 18, 9)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define HTTPS_PORT             443</span></div><div class="line"><span class="preprocessor">#define MAX_SOCKETS            2</span></div><div class="line"></div><div class="line"><span class="comment">/* Configure the following credentials for a secure HTTP connection */</span></div><div class="line"><span class="comment">/* SSL server certificate */</span></div><div class="line"><span class="preprocessor">#define SSL_SERVERCERT_PEM      \</span></div><div class="line"><span class="preprocessor">&quot;-----BEGIN CERTIFICATE-----\n&quot; \</span></div><div class="line"><span class="preprocessor">&quot;........base64 data........\n&quot; \</span></div><div class="line"><span class="preprocessor">&quot;-----END CERTIFICATE-----&quot;</span></div><div class="line"></div><div class="line"><span class="comment">/* SSL server private key */</span></div><div class="line"><span class="preprocessor">#define SSL_SERVERKEY_PEM          \</span></div><div class="line"><span class="preprocessor">&quot;-----BEGIN RSA PRIVATE KEY-----\n&quot; \</span></div><div class="line"><span class="preprocessor">&quot;..........base64 data..........\n&quot; \</span></div><div class="line"><span class="preprocessor">&quot;-----END RSA PRIVATE KEY-----&quot;</span></div><div class="line"></div><div class="line"><a class="code" href="group__http__server__struct.html#ga047ac1c7063077c58da4cc991ad3b1bf">cy_http_server_t</a>          httpSer;</div><div class="line">cy_network_interface_t    nw_interface;</div><div class="line">cy_socket_sockaddr_t      IP_address;</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> snippet_http_secure_create(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* Status variables for various operations */</span></div><div class="line">    cy_rslt_t TestRes = <a class="code" href="group__http__server__defines.html#gaf18faa0179a6087e4b03d9a81d02010e">CY_RSLT_ERROR</a>;</div><div class="line">    (void)TestRes;</div><div class="line">    <a class="code" href="structcy__https__server__security__info__t.html">cy_https_server_security_info_t</a> security_cred;</div><div class="line"></div><div class="line">    security_cred.<a class="code" href="structcy__https__server__security__info__t.html#ac99aee7927d640ff6dfbe200dc44d8ae">certificate</a>                = (uint8_t*) SSL_SERVERCERT_PEM;</div><div class="line">    security_cred.<a class="code" href="structcy__https__server__security__info__t.html#a3025afbe193cd4e514a711f09d3024e4">certificate_length</a>         = strlen(SSL_SERVERCERT_PEM);</div><div class="line">    security_cred.<a class="code" href="structcy__https__server__security__info__t.html#ab0df9038e60cccd0e8812c813c6b4c13">private_key</a>                = (uint8_t*) SSL_SERVERKEY_PEM;</div><div class="line">    security_cred.<a class="code" href="structcy__https__server__security__info__t.html#ad9a1a0499abc77950cfde7aa19a9e3a2">key_length</a>                 = strlen(SSL_SERVERKEY_PEM);</div><div class="line">    security_cred.<a class="code" href="structcy__https__server__security__info__t.html#af85967438ec03bba793c57ea2f7d1b2c">root_ca_certificate</a>        = NULL;</div><div class="line">    security_cred.<a class="code" href="structcy__https__server__security__info__t.html#a1b1bd39e4abc48f6789b001c7d67a554">root_ca_certificate_length</a> = 0;</div><div class="line"></div><div class="line">    <span class="comment">/* IP address of the server */</span></div><div class="line">    IP_address.ip_address.ip.v4 = SERVER_IP_ADDRESS;</div><div class="line">    IP_address.ip_address.version = CY_SOCKET_IP_VER_V4;</div><div class="line"></div><div class="line">    <span class="comment">/* Add the IP_address information to the network interface object */</span></div><div class="line">    nw_interface.object  = (<span class="keywordtype">void</span> *) &amp;IP_address;</div><div class="line">    nw_interface.type = CY_NW_INF_TYPE_WIFI;</div><div class="line"></div><div class="line">    <span class="comment">/* Initialize the network socket */</span></div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#ga74c8a85310d1537177f80adaef20cfd9">cy_http_server_network_init</a>();</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#ga1ca51f61222e3aed87c0a15955e2e269">cy_http_server_create</a>( &amp;nw_interface, HTTPS_PORT, MAX_SOCKETS, &amp;security_cred, &amp;httpSer );</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="snip3"></a>
Code Snippet 3: Registering a Static Resource</h2>
<p>Registers a static resource with the HTTP server using the <a class="el" href="group__group__c__api__functions.html#gad03c8e19c0792c4307356e52ba3006ee">cy_http_server_register_resource</a> API function. </p><div class="fragment"><div class="line"><span class="preprocessor">#define MAKE_IPV4_ADDRESS(a, b, c, d)     ((((uint32_t) d) &lt;&lt; 24) | \</span></div><div class="line"><span class="preprocessor">                                          (((uint32_t) c) &lt;&lt; 16) | \</span></div><div class="line"><span class="preprocessor">                                          (((uint32_t) b) &lt;&lt; 8) |\</span></div><div class="line"><span class="preprocessor">                                          ((uint32_t) a))</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define SERVER_IP_ADDRESS                 MAKE_IPV4_ADDRESS(192, 168, 18, 9)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define HTTP_PORT            80</span></div><div class="line"><span class="preprocessor">#define MAX_SOCKETS          2</span></div><div class="line"></div><div class="line"><span class="comment">/* HTML page sent in response to the client */</span></div><div class="line"><span class="preprocessor">#define CAPTIVE_PORTAL_REDIRECT_PAGE \</span></div><div class="line"><span class="preprocessor">&quot;&lt;html&gt;&lt;head&gt;&quot; \</span></div><div class="line"><span class="preprocessor">&quot;Hello, This is a reference HTTP server application&quot; \</span></div><div class="line"><span class="preprocessor">&quot;&lt;/head&gt;&lt;/html&gt;&quot;</span></div><div class="line"></div><div class="line"><a class="code" href="group__http__server__struct.html#ga047ac1c7063077c58da4cc991ad3b1bf">cy_http_server_t</a>          httpSer;</div><div class="line">cy_network_interface_t    nw_interface;</div><div class="line">cy_socket_sockaddr_t      IP_address;</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> snippet_http_static_reg_resource(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* Status variables for various operations */</span></div><div class="line">    cy_rslt_t TestRes = <a class="code" href="group__http__server__defines.html#gaf18faa0179a6087e4b03d9a81d02010e">CY_RSLT_ERROR</a>;</div><div class="line">    (void)TestRes;</div><div class="line">    <span class="comment">/* IP address of the server */</span></div><div class="line">    IP_address.ip_address.ip.v4 = SERVER_IP_ADDRESS;</div><div class="line">    IP_address.ip_address.version = CY_SOCKET_IP_VER_V4;</div><div class="line"></div><div class="line">    <span class="comment">/* Add the IP_address information to the network interface object */</span></div><div class="line">    nw_interface.object  = (<span class="keywordtype">void</span> *) &amp;IP_address;</div><div class="line">    nw_interface.type = CY_NW_INF_TYPE_WIFI;</div><div class="line"></div><div class="line">    <span class="comment">/* Initialize the network socket */</span></div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#ga74c8a85310d1537177f80adaef20cfd9">cy_http_server_network_init</a>();</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#ga1ca51f61222e3aed87c0a15955e2e269">cy_http_server_create</a>( &amp;nw_interface, HTTP_PORT, MAX_SOCKETS, NULL, &amp;httpSer );</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">    <span class="comment">/* Register a static resource with the HTTP server */</span></div><div class="line">    <a class="code" href="structcy__resource__static__data__t.html">cy_resource_static_data_t</a> static_resource;</div><div class="line">    static_resource.<a class="code" href="structcy__resource__static__data__t.html#a898a2959797f5d333f70915e27c8f8bf">data</a> = CAPTIVE_PORTAL_REDIRECT_PAGE;</div><div class="line">    static_resource.<a class="code" href="structcy__resource__static__data__t.html#a288d94a277b56b226480d6d18e7787ce">length</a> = <span class="keyword">sizeof</span>( CAPTIVE_PORTAL_REDIRECT_PAGE );</div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#gad03c8e19c0792c4307356e52ba3006ee">cy_http_server_register_resource</a>( httpSer, (uint8_t*) <span class="stringliteral">&quot;/get&quot;</span>, (uint8_t*)<span class="stringliteral">&quot;text/html&quot;</span>, <a class="code" href="group__http__server__struct.html#gga32d601085911dbd59b7ecd50a6b7f584a16c98c125133981542d412c2449988a1">CY_STATIC_URL_CONTENT</a>, &amp;static_resource);</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="snip4"></a>
Code Snippet 4: Registering a Dynamic Resource</h2>
<p>Registers a dynamic resource with the HTTP server using the <a class="el" href="group__group__c__api__functions.html#gad03c8e19c0792c4307356e52ba3006ee">cy_http_server_register_resource</a> API function. </p><div class="fragment"><div class="line"><span class="preprocessor">#define MAKE_IPV4_ADDRESS(a, b, c, d)     ((((uint32_t) d) &lt;&lt; 24) | \</span></div><div class="line"><span class="preprocessor">                                          (((uint32_t) c) &lt;&lt; 16) | \</span></div><div class="line"><span class="preprocessor">                                          (((uint32_t) b) &lt;&lt; 8) |\</span></div><div class="line"><span class="preprocessor">                                          ((uint32_t) a))</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define SERVER_IP_ADDRESS                 MAKE_IPV4_ADDRESS(192, 168, 18, 9)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define HTTP_PORT            80</span></div><div class="line"><span class="preprocessor">#define MAX_SOCKETS          2</span></div><div class="line"><span class="preprocessor">#define BUFFER_LENGTH        1500</span></div><div class="line"></div><div class="line"><span class="comment">/* HTML page sent in response to the client */</span></div><div class="line"><span class="preprocessor">#define CAPTIVE_PORTAL_REDIRECT_PAGE \</span></div><div class="line"><span class="preprocessor">&quot;&lt;html&gt;&lt;head&gt;&quot; \</span></div><div class="line"><span class="preprocessor">&quot;Hello, This is a reference HTTP server application&quot; \</span></div><div class="line"><span class="preprocessor">&quot;&lt;/head&gt;&lt;/html&gt;&quot;</span></div><div class="line"></div><div class="line"><a class="code" href="group__http__server__struct.html#ga047ac1c7063077c58da4cc991ad3b1bf">cy_http_server_t</a>          httpSer;</div><div class="line">cy_network_interface_t    nw_interface;</div><div class="line">cy_socket_sockaddr_t      IP_address;</div><div class="line"><span class="keywordtype">char</span>                      buffer[BUFFER_LENGTH];</div><div class="line"><span class="keywordtype">int</span>                       length = 0;</div><div class="line"></div><div class="line">int32_t process_handler( <span class="keyword">const</span> <span class="keywordtype">char</span>* url_path, <span class="keyword">const</span> <span class="keywordtype">char</span>* url_parameters, <a class="code" href="structcy__http__response__stream__t.html">cy_http_response_stream_t</a>* stream,</div><div class="line">                         <span class="keywordtype">void</span>* arg, <a class="code" href="structcy__http__message__body__t.html">cy_http_message_body_t</a>* http_message_body )</div><div class="line">{</div><div class="line">    memset(buffer, 0, BUFFER_LENGTH);</div><div class="line">    memcpy( buffer, http_message_body-&gt;<a class="code" href="structcy__http__message__body__t.html#a3d07565cc43cf954e63ebaa5c2db1ca6">data</a>, http_message_body-&gt;<a class="code" href="structcy__http__message__body__t.html#a3cfde2375f1e55e21bd204a8f843f473">data_length</a>);</div><div class="line">    length += http_message_body-&gt;<a class="code" href="structcy__http__message__body__t.html#a3cfde2375f1e55e21bd204a8f843f473">data_length</a>;</div><div class="line">    <span class="keywordflow">if</span> (http_message_body-&gt;<a class="code" href="structcy__http__message__body__t.html#afeaaa983c593be6dc2ba404ea086d44c">data_remaining</a> == 0)</div><div class="line">    {</div><div class="line">        <a class="code" href="group__group__c__api__functions.html#ga743dd1f394056a6ac09a6d4d8f17035c">cy_http_server_response_stream_write_payload</a>(stream, CAPTIVE_PORTAL_REDIRECT_PAGE, <span class="keyword">sizeof</span>(CAPTIVE_PORTAL_REDIRECT_PAGE));</div><div class="line">        length = 0;</div><div class="line">        memset(buffer, 0, BUFFER_LENGTH);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> snippet_http_dynamic_reg_resource(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* Status variables for various operations */</span></div><div class="line">    cy_rslt_t TestRes = <a class="code" href="group__http__server__defines.html#gaf18faa0179a6087e4b03d9a81d02010e">CY_RSLT_ERROR</a>;</div><div class="line">    (void)TestRes;</div><div class="line">    <span class="comment">/* IP address of the server */</span></div><div class="line">    IP_address.ip_address.ip.v4 = SERVER_IP_ADDRESS;</div><div class="line">    IP_address.ip_address.version = CY_SOCKET_IP_VER_V4;</div><div class="line"></div><div class="line">    <span class="comment">/* Add the IP_address information to the network interface object */</span></div><div class="line">    nw_interface.object  = (<span class="keywordtype">void</span> *) &amp;IP_address;</div><div class="line">    nw_interface.type = CY_NW_INF_TYPE_WIFI;</div><div class="line"></div><div class="line">    <span class="comment">/* Initialize the network socket */</span></div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#ga74c8a85310d1537177f80adaef20cfd9">cy_http_server_network_init</a>();</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#ga1ca51f61222e3aed87c0a15955e2e269">cy_http_server_create</a>( &amp;nw_interface, HTTP_PORT, MAX_SOCKETS, NULL, &amp;httpSer );</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">    <span class="comment">/* Register a dynamic resource with the HTTP server */</span></div><div class="line">    <a class="code" href="structcy__resource__dynamic__data__t.html">cy_resource_dynamic_data_t</a> dynamic_resource;</div><div class="line">    dynamic_resource.<a class="code" href="structcy__resource__dynamic__data__t.html#a2fa3f6203db2348184a4cd0409c1d6cb">resource_handler</a> = process_handler;</div><div class="line">    dynamic_resource.<a class="code" href="structcy__resource__dynamic__data__t.html#a21189a067fa29eb836db706aa3553f2b">arg</a> = NULL;</div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#gad03c8e19c0792c4307356e52ba3006ee">cy_http_server_register_resource</a>( httpSer, (uint8_t*) <span class="stringliteral">&quot;/post&quot;</span>, (uint8_t*)<span class="stringliteral">&quot;text/html&quot;</span>, <a class="code" href="group__http__server__struct.html#gga32d601085911dbd59b7ecd50a6b7f584ab61d536399015bfa53ede0e680aae9f7">CY_DYNAMIC_URL_CONTENT</a>, &amp;dynamic_resource);</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="snip5"></a>
Code Snippet 5: Registering a Server-Sent Event (SSE)</h2>
<p>Registers a Server-Sent Event using the <a class="el" href="group__group__c__api__functions.html#gad03c8e19c0792c4307356e52ba3006ee">cy_http_server_register_resource</a> API function. </p><div class="fragment"><div class="line"><span class="preprocessor">#define MAKE_IPV4_ADDRESS(a, b, c, d)     ((((uint32_t) d) &lt;&lt; 24) | \</span></div><div class="line"><span class="preprocessor">                                          (((uint32_t) c) &lt;&lt; 16) | \</span></div><div class="line"><span class="preprocessor">                                          (((uint32_t) b) &lt;&lt; 8) |\</span></div><div class="line"><span class="preprocessor">                                          ((uint32_t) a))</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define SERVER_IP_ADDRESS                 MAKE_IPV4_ADDRESS(192, 168, 18, 9)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define HTTP_PORT                80</span></div><div class="line"><span class="preprocessor">#define MAX_SOCKETS              2</span></div><div class="line"><span class="preprocessor">#define CHUNKED_CONTENT_LENGTH   0</span></div><div class="line"></div><div class="line"><a class="code" href="group__http__server__struct.html#ga047ac1c7063077c58da4cc991ad3b1bf">cy_http_server_t</a>               httpSer;</div><div class="line">cy_network_interface_t         nw_interface;</div><div class="line"><a class="code" href="structcy__http__response__stream__t.html">cy_http_response_stream_t</a>*     http_event_stream;</div><div class="line">cy_socket_sockaddr_t           IP_address;</div><div class="line"></div><div class="line">int32_t anycloud_process_SSE_handler( <span class="keyword">const</span> <span class="keywordtype">char</span>* url_path, <span class="keyword">const</span> <span class="keywordtype">char</span>* url_parameters,</div><div class="line">                                      <a class="code" href="structcy__http__response__stream__t.html">cy_http_response_stream_t</a>* stream, <span class="keywordtype">void</span>* arg,</div><div class="line">                                      <a class="code" href="structcy__http__message__body__t.html">cy_http_message_body_t</a>* http_message_body )</div><div class="line">{</div><div class="line">    http_event_stream = stream;</div><div class="line">    <span class="comment">/* Enable chunked transfer encoding on the HTTP stream */</span></div><div class="line">    <a class="code" href="group__group__c__api__functions.html#gaf4743c3b0e6ef9ba4afc5e1b5531691f">cy_http_server_response_stream_enable_chunked_transfer</a>( http_event_stream );</div><div class="line">    <a class="code" href="group__group__c__api__functions.html#gafb8df6439fdadb46d738ecd43cbaf002">cy_http_server_response_stream_write_header</a>( http_event_stream, <a class="code" href="group__http__server__struct.html#ggad1b0486d4ab51b5b1969e54aae1e5eddad3dbd9c89c618dff06785fdd77ec0419">CY_HTTP_200_TYPE</a>, CHUNKED_CONTENT_LENGTH,</div><div class="line">                                               <a class="code" href="group__http__server__struct.html#gga64b862dacedd67c3d74845c1a6038b89a21676ce46eff61339e33dded1daeaaea">CY_HTTP_CACHE_DISABLED</a>, MIME_TYPE_TEXT_EVENT_STREAM );</div><div class="line">    <span class="comment">/* Disable chunked transfer encoding on the HTTP stream after header write is completed */</span></div><div class="line">    <a class="code" href="group__group__c__api__functions.html#gab24071765e97d90225a33ead1318298e">cy_http_server_response_stream_disable_chunked_transfer</a>( http_event_stream );</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> snippet_http_server_event_reg(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* Status variables for various operations */</span></div><div class="line">    cy_rslt_t TestRes = <a class="code" href="group__http__server__defines.html#gaf18faa0179a6087e4b03d9a81d02010e">CY_RSLT_ERROR</a>;</div><div class="line">    (void)TestRes;</div><div class="line">    <span class="comment">/* IP address of the server */</span></div><div class="line">    IP_address.ip_address.ip.v4 = SERVER_IP_ADDRESS;</div><div class="line">    IP_address.ip_address.version = CY_SOCKET_IP_VER_V4;</div><div class="line"></div><div class="line">    <span class="comment">/* Add the IP_address information to the network interface object */</span></div><div class="line">    nw_interface.object  = (<span class="keywordtype">void</span> *) &amp;IP_address;</div><div class="line">    nw_interface.type = CY_NW_INF_TYPE_WIFI;</div><div class="line"></div><div class="line">    <span class="comment">/* Initialize the network socket */</span></div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#ga74c8a85310d1537177f80adaef20cfd9">cy_http_server_network_init</a>();</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#ga1ca51f61222e3aed87c0a15955e2e269">cy_http_server_create</a>( &amp;nw_interface, HTTP_PORT, MAX_SOCKETS, NULL, &amp;httpSer );</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">    <a class="code" href="structcy__resource__dynamic__data__t.html">cy_resource_dynamic_data_t</a> dynamic_sse_resource;</div><div class="line">    dynamic_sse_resource.<a class="code" href="structcy__resource__dynamic__data__t.html#a2fa3f6203db2348184a4cd0409c1d6cb">resource_handler</a> = anycloud_process_SSE_handler;</div><div class="line">    dynamic_sse_resource.<a class="code" href="structcy__resource__dynamic__data__t.html#a21189a067fa29eb836db706aa3553f2b">arg</a> = NULL;</div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#gad03c8e19c0792c4307356e52ba3006ee">cy_http_server_register_resource</a>( httpSer, (uint8_t*) <span class="stringliteral">&quot;/events&quot;</span>, (uint8_t*)<span class="stringliteral">&quot;text/event-stream&quot;</span>, <a class="code" href="group__http__server__struct.html#gga32d601085911dbd59b7ecd50a6b7f584a6b8d1cd5fef8b7ffc82c06591b8e3bc1">CY_RAW_DYNAMIC_URL_CONTENT</a>, &amp;dynamic_sse_resource);</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="snip6"></a>
Code Snippet 6: HTTP Server Start</h2>
<p>Starts the HTTP server using the <a class="el" href="group__group__c__api__functions.html#ga3cb020a5e45f80b55ea3fc2eb1c6c3df">cy_http_server_start</a> API function. </p><div class="fragment"><div class="line"><span class="preprocessor">#define MAKE_IPV4_ADDRESS(a, b, c, d)     ((((uint32_t) d) &lt;&lt; 24) | \</span></div><div class="line"><span class="preprocessor">                                          (((uint32_t) c) &lt;&lt; 16) | \</span></div><div class="line"><span class="preprocessor">                                          (((uint32_t) b) &lt;&lt; 8) |\</span></div><div class="line"><span class="preprocessor">                                          ((uint32_t) a))</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define SERVER_IP_ADDRESS                 MAKE_IPV4_ADDRESS(192, 168, 18, 9)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define HTTP_PORT            80</span></div><div class="line"><span class="preprocessor">#define MAX_SOCKETS          2</span></div><div class="line"></div><div class="line"><span class="comment">/* HTML page sent in response to the client */</span></div><div class="line"><span class="preprocessor">#define CAPTIVE_PORTAL_REDIRECT_PAGE \</span></div><div class="line"><span class="preprocessor">&quot;&lt;html&gt;&lt;head&gt;&quot; \</span></div><div class="line"><span class="preprocessor">&quot;Hello, This is a reference HTTP server application&quot; \</span></div><div class="line"><span class="preprocessor">&quot;&lt;/head&gt;&lt;/html&gt;&quot;</span></div><div class="line"></div><div class="line"><a class="code" href="group__http__server__struct.html#ga047ac1c7063077c58da4cc991ad3b1bf">cy_http_server_t</a>          httpSer;</div><div class="line">cy_network_interface_t    nw_interface;</div><div class="line">cy_socket_sockaddr_t      IP_address;</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> snippet_http_server_start(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* Status variables for various operations */</span></div><div class="line">    cy_rslt_t TestRes = <a class="code" href="group__http__server__defines.html#gaf18faa0179a6087e4b03d9a81d02010e">CY_RSLT_ERROR</a>;</div><div class="line">    (void)TestRes;</div><div class="line">    <span class="comment">/* IP address of the server */</span></div><div class="line">    IP_address.ip_address.ip.v4 = SERVER_IP_ADDRESS;</div><div class="line">    IP_address.ip_address.version = CY_SOCKET_IP_VER_V4;</div><div class="line"></div><div class="line">    <span class="comment">/* Add the IP_address information to the network interface object */</span></div><div class="line">    nw_interface.object  = (<span class="keywordtype">void</span> *) &amp;IP_address;</div><div class="line">    nw_interface.type = CY_NW_INF_TYPE_WIFI;</div><div class="line"></div><div class="line">    <span class="comment">/* Initialize the network socket */</span></div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#ga74c8a85310d1537177f80adaef20cfd9">cy_http_server_network_init</a>();</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#ga1ca51f61222e3aed87c0a15955e2e269">cy_http_server_create</a>( &amp;nw_interface, HTTP_PORT, MAX_SOCKETS, NULL, &amp;httpSer );</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">    <span class="comment">/* Register a static resource with the HTTP server */</span></div><div class="line">    <a class="code" href="structcy__resource__static__data__t.html">cy_resource_static_data_t</a> static_resource;</div><div class="line">    static_resource.<a class="code" href="structcy__resource__static__data__t.html#a898a2959797f5d333f70915e27c8f8bf">data</a> = CAPTIVE_PORTAL_REDIRECT_PAGE;</div><div class="line">    static_resource.<a class="code" href="structcy__resource__static__data__t.html#a288d94a277b56b226480d6d18e7787ce">length</a> = <span class="keyword">sizeof</span>( CAPTIVE_PORTAL_REDIRECT_PAGE );</div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#gad03c8e19c0792c4307356e52ba3006ee">cy_http_server_register_resource</a>( httpSer, (uint8_t*) <span class="stringliteral">&quot;/get&quot;</span>, (uint8_t*)<span class="stringliteral">&quot;text/html&quot;</span>, <a class="code" href="group__http__server__struct.html#gga32d601085911dbd59b7ecd50a6b7f584a16c98c125133981542d412c2449988a1">CY_STATIC_URL_CONTENT</a>, &amp;static_resource );</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">    <span class="comment">/* Start HTTP server */</span></div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#ga3cb020a5e45f80b55ea3fc2eb1c6c3df">cy_http_server_start</a>( httpSer );</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="snip7"></a>
Code Snippet 7: Sending HTTP Server Events</h2>
<p>Sends HTTP server events using the <a class="el" href="group__group__c__api__functions.html#gafb8df6439fdadb46d738ecd43cbaf002">cy_http_server_response_stream_write_header</a> API function. </p><div class="fragment"><div class="line"><span class="preprocessor">#define MAKE_IPV4_ADDRESS(a, b, c, d)     ((((uint32_t) d) &lt;&lt; 24) | \</span></div><div class="line"><span class="preprocessor">                                          (((uint32_t) c) &lt;&lt; 16) | \</span></div><div class="line"><span class="preprocessor">                                          (((uint32_t) b) &lt;&lt; 8) |\</span></div><div class="line"><span class="preprocessor">                                          ((uint32_t) a))</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define SERVER_IP_ADDRESS                 MAKE_IPV4_ADDRESS(192, 168, 18, 9)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define HTTP_PORT              80</span></div><div class="line"><span class="preprocessor">#define MAX_SOCKETS            2</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define SSE_PAYLOAD            &quot;Hello, This is server sent events \r\n&quot;</span></div><div class="line"><span class="preprocessor">#define LFLF                   &quot;\n\n&quot;</span></div><div class="line"><span class="preprocessor">#define EVENT_STREAM_DATA      &quot;data: &quot;</span></div><div class="line"><span class="preprocessor">#define CHUNKED_CONTENT_LENGTH 0</span></div><div class="line"></div><div class="line"><a class="code" href="structcy__http__response__stream__t.html">cy_http_response_stream_t</a>*     http_event_stream;</div><div class="line"><a class="code" href="group__http__server__struct.html#ga047ac1c7063077c58da4cc991ad3b1bf">cy_http_server_t</a>               httpSer;</div><div class="line">cy_network_interface_t         nw_interface;</div><div class="line">cy_socket_sockaddr_t           IP_address;</div><div class="line"></div><div class="line">int32_t process_SSE_handler( <span class="keyword">const</span> <span class="keywordtype">char</span>* url_path, <span class="keyword">const</span> <span class="keywordtype">char</span>* url_parameters,</div><div class="line">                                           <a class="code" href="structcy__http__response__stream__t.html">cy_http_response_stream_t</a>* stream, <span class="keywordtype">void</span>* arg,</div><div class="line">                                           <a class="code" href="structcy__http__message__body__t.html">cy_http_message_body_t</a>* http_message_body )</div><div class="line">{</div><div class="line">    http_event_stream = stream;</div><div class="line">    <a class="code" href="group__group__c__api__functions.html#gaf4743c3b0e6ef9ba4afc5e1b5531691f">cy_http_server_response_stream_enable_chunked_transfer</a>( http_event_stream );</div><div class="line">    <a class="code" href="group__group__c__api__functions.html#gafb8df6439fdadb46d738ecd43cbaf002">cy_http_server_response_stream_write_header</a>( http_event_stream, <a class="code" href="group__http__server__struct.html#ggad1b0486d4ab51b5b1969e54aae1e5eddad3dbd9c89c618dff06785fdd77ec0419">CY_HTTP_200_TYPE</a>, CHUNKED_CONTENT_LENGTH,</div><div class="line">                                                 <a class="code" href="group__http__server__struct.html#gga64b862dacedd67c3d74845c1a6038b89a21676ce46eff61339e33dded1daeaaea">CY_HTTP_CACHE_DISABLED</a>, MIME_TYPE_TEXT_EVENT_STREAM );</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> send_events()</div><div class="line">{</div><div class="line">    cy_rslt_t result;</div><div class="line">    <span class="keywordflow">if</span>( http_event_stream == NULL )</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line">    }</div><div class="line">    result = <a class="code" href="group__group__c__api__functions.html#ga743dd1f394056a6ac09a6d4d8f17035c">cy_http_server_response_stream_write_payload</a>( http_event_stream, (<span class="keyword">const</span> <span class="keywordtype">void</span>*)EVENT_STREAM_DATA, <span class="keyword">sizeof</span>( EVENT_STREAM_DATA ) - 1 );</div><div class="line">    <span class="keywordflow">if</span> ( result != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        http_event_stream = NULL;</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line">    }</div><div class="line">    <span class="comment">/* Send message to client */</span></div><div class="line">    result = <a class="code" href="group__group__c__api__functions.html#ga743dd1f394056a6ac09a6d4d8f17035c">cy_http_server_response_stream_write_payload</a>( http_event_stream, SSE_PAYLOAD, <span class="keyword">sizeof</span>(SSE_PAYLOAD) - 1);</div><div class="line">    <span class="keywordflow">if</span> ( result != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        http_event_stream = NULL;</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line">    }</div><div class="line">    <span class="comment">/* SSE is ended with two line feeds */</span></div><div class="line">    result = <a class="code" href="group__group__c__api__functions.html#ga743dd1f394056a6ac09a6d4d8f17035c">cy_http_server_response_stream_write_payload</a>( http_event_stream, (<span class="keyword">const</span> <span class="keywordtype">void</span>*)LFLF, <span class="keyword">sizeof</span>( LFLF ) - 1 );</div><div class="line">    <span class="keywordflow">if</span> ( result != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        http_event_stream = NULL;</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> snippet_http_server_send_events(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* Status variables for various operations */</span></div><div class="line">    cy_rslt_t TestRes = <a class="code" href="group__http__server__defines.html#gaf18faa0179a6087e4b03d9a81d02010e">CY_RSLT_ERROR</a>;</div><div class="line">    (void)TestRes;</div><div class="line">    <span class="comment">/* IP address of the server */</span></div><div class="line">    IP_address.ip_address.ip.v4 = SERVER_IP_ADDRESS;</div><div class="line">    IP_address.ip_address.version = CY_SOCKET_IP_VER_V4;</div><div class="line"></div><div class="line">    <span class="comment">/* Add the IP_address information to the network interface object */</span></div><div class="line">    nw_interface.object  = (<span class="keywordtype">void</span> *) &amp;IP_address;</div><div class="line">    nw_interface.type = CY_NW_INF_TYPE_WIFI;</div><div class="line"></div><div class="line">    <span class="comment">/* Initialize the network socket */</span></div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#ga74c8a85310d1537177f80adaef20cfd9">cy_http_server_network_init</a>();</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#ga1ca51f61222e3aed87c0a15955e2e269">cy_http_server_create</a>( &amp;nw_interface, HTTP_PORT, MAX_SOCKETS, NULL, &amp;httpSer );</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">    <a class="code" href="structcy__resource__dynamic__data__t.html">cy_resource_dynamic_data_t</a> dynamic_sse_resource;</div><div class="line">    dynamic_sse_resource.<a class="code" href="structcy__resource__dynamic__data__t.html#a2fa3f6203db2348184a4cd0409c1d6cb">resource_handler</a> = process_SSE_handler;</div><div class="line">    dynamic_sse_resource.<a class="code" href="structcy__resource__dynamic__data__t.html#a21189a067fa29eb836db706aa3553f2b">arg</a> = NULL;</div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#gad03c8e19c0792c4307356e52ba3006ee">cy_http_server_register_resource</a>( httpSer, (uint8_t*) <span class="stringliteral">&quot;/events&quot;</span>, (uint8_t*)<span class="stringliteral">&quot;text/event-stream&quot;</span>, <a class="code" href="group__http__server__struct.html#gga32d601085911dbd59b7ecd50a6b7f584a6b8d1cd5fef8b7ffc82c06591b8e3bc1">CY_RAW_DYNAMIC_URL_CONTENT</a>, &amp;dynamic_sse_resource);</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">    <span class="comment">/* Start HTTP server */</span></div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#ga3cb020a5e45f80b55ea3fc2eb1c6c3df">cy_http_server_start</a>( httpSer );</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">    <span class="comment">/* Send server events */</span></div><div class="line">    <span class="keywordflow">if</span>( http_event_stream != NULL )</div><div class="line">    {</div><div class="line">        send_events();</div><div class="line">    }</div><div class="line">    <span class="comment">/* Disconnect event stream */</span></div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#gaf051d4ad577610bdbd38fa6aa8297592">cy_http_server_response_stream_disconnect</a>( http_event_stream );</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">    <span class="comment">/* Disconnect all streams */</span></div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#gaf6442a83a82a102c4490280d85e0ef88">cy_http_server_response_stream_disconnect_all</a>( httpSer );</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="snip8"></a>
Code Snippet 8: HTTP Server Stop</h2>
<p>Stops the HTTP server using the <a class="el" href="group__group__c__api__functions.html#ga9883b5677f3f49d229d8883f414e9806">cy_http_server_stop</a> API function. </p><div class="fragment"><div class="line"><span class="preprocessor">#define MAKE_IPV4_ADDRESS(a, b, c, d)     ((((uint32_t) d) &lt;&lt; 24) | \</span></div><div class="line"><span class="preprocessor">                                          (((uint32_t) c) &lt;&lt; 16) | \</span></div><div class="line"><span class="preprocessor">                                          (((uint32_t) b) &lt;&lt; 8) |\</span></div><div class="line"><span class="preprocessor">                                          ((uint32_t) a))</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define SERVER_IP_ADDRESS                 MAKE_IPV4_ADDRESS(192, 168, 18, 9)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define HTTP_PORT            80</span></div><div class="line"><span class="preprocessor">#define MAX_SOCKETS          2</span></div><div class="line"></div><div class="line"><span class="comment">/* HTML page sent in response to the client */</span></div><div class="line"><span class="preprocessor">#define CAPTIVE_PORTAL_REDIRECT_PAGE \</span></div><div class="line"><span class="preprocessor">&quot;&lt;html&gt;&lt;head&gt;&quot; \</span></div><div class="line"><span class="preprocessor">&quot;Hello, This is a reference HTTP server application&quot; \</span></div><div class="line"><span class="preprocessor">&quot;&lt;/head&gt;&lt;/html&gt;&quot;</span></div><div class="line"></div><div class="line"><a class="code" href="group__http__server__struct.html#ga047ac1c7063077c58da4cc991ad3b1bf">cy_http_server_t</a>          httpSer;</div><div class="line">cy_network_interface_t    nw_interface;</div><div class="line">cy_socket_sockaddr_t      IP_address;</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> snippet_http_server_stop(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* Status variables for various operations */</span></div><div class="line">    cy_rslt_t TestRes = <a class="code" href="group__http__server__defines.html#gaf18faa0179a6087e4b03d9a81d02010e">CY_RSLT_ERROR</a>;</div><div class="line">    (void)TestRes;</div><div class="line">    <span class="comment">/* IP address of the server */</span></div><div class="line">    IP_address.ip_address.ip.v4 = SERVER_IP_ADDRESS;</div><div class="line">    IP_address.ip_address.version = CY_SOCKET_IP_VER_V4;</div><div class="line"></div><div class="line">    <span class="comment">/* Add the IP_address information to the network interface object */</span></div><div class="line">    nw_interface.object  = (<span class="keywordtype">void</span> *) &amp;IP_address;</div><div class="line">    nw_interface.type = CY_NW_INF_TYPE_WIFI;</div><div class="line"></div><div class="line">    <span class="comment">/* Initialize the network socket */</span></div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#ga74c8a85310d1537177f80adaef20cfd9">cy_http_server_network_init</a>();</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#ga1ca51f61222e3aed87c0a15955e2e269">cy_http_server_create</a>( &amp;nw_interface, HTTP_PORT, MAX_SOCKETS, NULL, &amp;httpSer );</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">    <span class="comment">/* Register a static resource with the HTTP server */</span></div><div class="line">    <a class="code" href="structcy__resource__static__data__t.html">cy_resource_static_data_t</a> static_resource;</div><div class="line">    static_resource.<a class="code" href="structcy__resource__static__data__t.html#a898a2959797f5d333f70915e27c8f8bf">data</a> = CAPTIVE_PORTAL_REDIRECT_PAGE;</div><div class="line">    static_resource.<a class="code" href="structcy__resource__static__data__t.html#a288d94a277b56b226480d6d18e7787ce">length</a> = <span class="keyword">sizeof</span>( CAPTIVE_PORTAL_REDIRECT_PAGE );</div><div class="line">    <a class="code" href="group__group__c__api__functions.html#gad03c8e19c0792c4307356e52ba3006ee">cy_http_server_register_resource</a>( httpSer, (uint8_t*) <span class="stringliteral">&quot;/get&quot;</span>, (uint8_t*)<span class="stringliteral">&quot;text/html&quot;</span>, <a class="code" href="group__http__server__struct.html#gga32d601085911dbd59b7ecd50a6b7f584a16c98c125133981542d412c2449988a1">CY_STATIC_URL_CONTENT</a>, &amp;static_resource );</div><div class="line">    <span class="comment">/* Start HTTP server */</span></div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#ga3cb020a5e45f80b55ea3fc2eb1c6c3df">cy_http_server_start</a>( httpSer );</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">    <span class="comment">/* Stop the HTTP server */</span></div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#ga9883b5677f3f49d229d8883f414e9806">cy_http_server_stop</a>( httpSer );</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">    <span class="comment">/* Delete the HTTP server object */</span></div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#ga13251efe44c82d506b1ccf48e5acc5dd">cy_http_server_delete</a>( httpSer );</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">    <span class="comment">/* Deinitialize the network socket */</span></div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#ga1922ac08bf92b285a8f96bb6170291af">cy_http_server_network_deinit</a>();</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Failure path */</span></div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="snip9"></a>
Code Snippet 9: HTTP URL query</h2>
<p>Search a key-value pair, fetch the value of a key, and get the number of queries from the given URL using URL-processing functions. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> snippet_http_server_url_query(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* Status variables for various operations */</span></div><div class="line">    cy_rslt_t TestRes = <a class="code" href="group__http__server__defines.html#gaf18faa0179a6087e4b03d9a81d02010e">CY_RSLT_ERROR</a>;</div><div class="line">    (void)TestRes;</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> url[] = <span class="stringliteral">&quot;https://example.com/?product=shirt&amp;color=blue&amp;newuser&amp;size=m\n&quot;</span>;</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> key[] = <span class="stringliteral">&quot;product\n&quot;</span>;</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> value[] = <span class="stringliteral">&quot;shirt\n&quot;</span>;</div><div class="line">    <span class="keywordtype">char</span> *value_found = NULL;</div><div class="line">    uint32_t value_length = 0;</div><div class="line">    uint32_t query_param_count = 0;</div><div class="line"></div><div class="line">    <span class="comment">/* Check if the provided key-value pair is present in the given URL */</span></div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#gac1cd7f7af7f2f9aa6e288be4e2a6419f">cy_http_server_match_query_parameter</a>( url, key, value );</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* URL query failed */</span></div><div class="line">    }</div><div class="line">    <span class="comment">/* Retrieve the value and length for a given key from the URL */</span></div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#gaf2bee362096d822f39a4851c63c5abf3">cy_http_server_get_query_parameter_value</a>( url, key, &amp;value_found, &amp;value_length );</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* URL query failed */</span></div><div class="line">    }</div><div class="line">    <span class="comment">/* Get the number of query parameters found in the URL query string. */</span></div><div class="line">    TestRes = <a class="code" href="group__group__c__api__functions.html#ga3825981f26c68c82d781f5fb7f2a4bfc">cy_http_server_get_query_parameter_count</a>( url, &amp;query_param_count );</div><div class="line">    <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        <span class="comment">/* URL query failed */</span></div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="section_code_snippet_Mbed"></a>
Mbed OS</h1>
<p>These code snippets demonstrate the initialization of the configuration structures required for the operation such as creating a secure or non-secure connection and registering a static or dynamic resource with the HTTP server. </p>
<h2><a class="anchor" id="snip10"></a>
Code Snippet 1: Creation and initialization of a non-secure HTTP server object</h2>
<p>Creates a non-secure HTTP connection using the <a class="el" href="class_h_t_t_p_server.html" title="Definition of the HTTP server class object. ">HTTPServer()</a> constructor. </p><div class="fragment"><div class="line"><span class="preprocessor">#define HTTP_PORT         80</span></div><div class="line"><span class="preprocessor">#define MAX_SOCKETS       2</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> snippet_http_non_secure_new(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    cy_network_interface_t nw_interface;</div><div class="line">    <a class="code" href="class_h_t_t_p_server.html">HTTPServer</a>*            server;</div><div class="line">    NetworkInterface*      network;</div><div class="line">    (void)server;</div><div class="line">    </div><div class="line">    network = NetworkInterface::get_default_instance();</div><div class="line">    network-&gt;connect();</div><div class="line">    nw_interface.object = (<span class="keywordtype">void</span>*) network;</div><div class="line"></div><div class="line">    <span class="comment">/* Create instance of HTTP server */</span></div><div class="line">    server = <span class="keyword">new</span> <a class="code" href="class_h_t_t_p_server.html">HTTPServer</a>(&amp;nw_interface, HTTP_PORT, MAX_SOCKETS);</div><div class="line">    <span class="keywordflow">if</span>(server != NULL)</div><div class="line">    {</div><div class="line">        <span class="comment">/* HTTP server object created successfully */</span></div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="snip11"></a>
Code Snippet 2: Creation and initialization of a secure HTTP server object</h2>
<p>Creates a secure HTTP connection using the <a class="el" href="class_h_t_t_p_server.html" title="Definition of the HTTP server class object. ">HTTPServer()</a> constructor. </p><div class="fragment"><div class="line"><span class="preprocessor">#define HTTPS_PORT         443</span></div><div class="line"><span class="preprocessor">#define MAX_SOCKETS        2</span></div><div class="line"></div><div class="line"><span class="comment">/* Configure the following credentials for an HTTP secure connection */</span></div><div class="line"><span class="comment">/* SSL server certificate */</span></div><div class="line"><span class="preprocessor">#define SSL_SERVERCERT_PEM      \</span></div><div class="line"><span class="preprocessor">&quot;-----BEGIN CERTIFICATE-----\n&quot; \</span></div><div class="line"><span class="preprocessor">&quot;........base64 data........\n&quot; \</span></div><div class="line"><span class="preprocessor">&quot;-----END CERTIFICATE-----&quot;</span></div><div class="line"></div><div class="line"><span class="comment">/* SSL server private key */</span></div><div class="line"><span class="preprocessor">#define SSL_SERVERKEY_PEM          \</span></div><div class="line"><span class="preprocessor">&quot;-----BEGIN RSA PRIVATE KEY-----\n&quot; \</span></div><div class="line"><span class="preprocessor">&quot;..........base64 data..........\n&quot; \</span></div><div class="line"><span class="preprocessor">&quot;-----END RSA PRIVATE KEY-----&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> snippet_http_secure_new(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    NetworkInterface*      network;</div><div class="line">    cy_network_interface_t nw_interface;</div><div class="line">    <a class="code" href="class_h_t_t_p_server.html">HTTPServer</a>*            server;</div><div class="line">    (void)server;</div><div class="line">        </div><div class="line">    <a class="code" href="structcy__https__server__security__info__t.html">cy_https_server_security_info_t</a> security_cred;</div><div class="line">    network = NetworkInterface::get_default_instance();</div><div class="line">    network-&gt;connect();</div><div class="line">    nw_interface.object = (<span class="keywordtype">void</span>*) network;</div><div class="line"></div><div class="line">    security_cred.<a class="code" href="structcy__https__server__security__info__t.html#ac99aee7927d640ff6dfbe200dc44d8ae">certificate</a>                = (uint8_t*) SSL_SERVERCERT_PEM;</div><div class="line">    security_cred.<a class="code" href="structcy__https__server__security__info__t.html#a3025afbe193cd4e514a711f09d3024e4">certificate_length</a>         = strlen(SSL_SERVERCERT_PEM);</div><div class="line">    security_cred.<a class="code" href="structcy__https__server__security__info__t.html#ab0df9038e60cccd0e8812c813c6b4c13">private_key</a>                = (uint8_t*) SSL_SERVERKEY_PEM;</div><div class="line">    security_cred.<a class="code" href="structcy__https__server__security__info__t.html#ad9a1a0499abc77950cfde7aa19a9e3a2">key_length</a>                 = strlen(SSL_SERVERKEY_PEM);</div><div class="line">    security_cred.<a class="code" href="structcy__https__server__security__info__t.html#af85967438ec03bba793c57ea2f7d1b2c">root_ca_certificate</a>        = NULL;</div><div class="line">    security_cred.<a class="code" href="structcy__https__server__security__info__t.html#a1b1bd39e4abc48f6789b001c7d67a554">root_ca_certificate_length</a> = 0;</div><div class="line"></div><div class="line">    server = <span class="keyword">new</span> <a class="code" href="class_h_t_t_p_server.html">HTTPServer</a>(&amp;nw_interface, HTTPS_PORT, MAX_SOCKETS, &amp;security_cred);</div><div class="line">    <span class="keywordflow">if</span>(server != NULL)</div><div class="line">    {</div><div class="line">        <span class="comment">/* HTTP server object created successfully */</span></div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="snip12"></a>
Code Snippet 3: Registering a static resource</h2>
<p>Registers a static resource with the HTTP server using the register_resource() API function. </p><div class="fragment"><div class="line"><span class="preprocessor">#define HTTP_PORT         80</span></div><div class="line"><span class="preprocessor">#define MAX_SOCKETS       2</span></div><div class="line"></div><div class="line"><span class="comment">/* HTML page sent in response to the client */</span></div><div class="line"><span class="preprocessor">#define CAPTIVE_PORTAL_REDIRECT_PAGE \</span></div><div class="line"><span class="preprocessor">&quot;&lt;html&gt;&lt;head&gt;&quot; \</span></div><div class="line"><span class="preprocessor">&quot;Hello, This is a reference HTTP server application&quot; \</span></div><div class="line"><span class="preprocessor">&quot;&lt;/head&gt;&lt;/html&gt;&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> snippet_mbed_http_static_reg_resource(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* Status variables for various operations */</span></div><div class="line">    cy_rslt_t TestRes = <a class="code" href="group__http__server__defines.html#gaf18faa0179a6087e4b03d9a81d02010e">CY_RSLT_ERROR</a>;</div><div class="line">    NetworkInterface*      network;</div><div class="line">    cy_network_interface_t nw_interface;</div><div class="line">    <a class="code" href="class_h_t_t_p_server.html">HTTPServer</a>*            server;</div><div class="line">    (void)TestRes;</div><div class="line"></div><div class="line">    network = NetworkInterface::get_default_instance();</div><div class="line">    network-&gt;connect();</div><div class="line">    nw_interface.object = (<span class="keywordtype">void</span>*) network;</div><div class="line"></div><div class="line">    <span class="comment">/* Create an instance of the HTTP server */</span></div><div class="line">    server = <span class="keyword">new</span> <a class="code" href="class_h_t_t_p_server.html">HTTPServer</a>(&amp;nw_interface, HTTP_PORT, MAX_SOCKETS);</div><div class="line"></div><div class="line">    <span class="comment">/* Register a static resource with the HTTP server */</span></div><div class="line">    <a class="code" href="structcy__resource__static__data__t.html">cy_resource_static_data_t</a> static_resource;</div><div class="line">    static_resource.<a class="code" href="structcy__resource__static__data__t.html#a898a2959797f5d333f70915e27c8f8bf">data</a> = CAPTIVE_PORTAL_REDIRECT_PAGE;</div><div class="line">    static_resource.<a class="code" href="structcy__resource__static__data__t.html#a288d94a277b56b226480d6d18e7787ce">length</a> = <span class="keyword">sizeof</span>( CAPTIVE_PORTAL_REDIRECT_PAGE );</div><div class="line">    TestRes = server-&gt;<a class="code" href="class_h_t_t_p_server.html#a58eb80fb7f039210cc9d7040f0008232">register_resource</a>((uint8_t*) <span class="stringliteral">&quot;/get&quot;</span>, (uint8_t*)<span class="stringliteral">&quot;text/html&quot;</span>, <a class="code" href="group__http__server__struct.html#gga32d601085911dbd59b7ecd50a6b7f584a16c98c125133981542d412c2449988a1">CY_STATIC_URL_CONTENT</a>, &amp;static_resource);</div><div class="line">    <span class="keywordflow">if</span>(TestRes == CY_RSLT_SUCCESS)</div><div class="line">    {</div><div class="line">        <span class="comment">/* Register Static resource completed */</span></div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="snip13"></a>
Code Snippet 4: Registering a dynamic resource</h2>
<p>Registers a dynamic resource with the HTTP server using the register_resource() API function. </p><div class="fragment"><div class="line"><span class="preprocessor">#define HTTP_PORT         80</span></div><div class="line"><span class="preprocessor">#define MAX_SOCKETS       2</span></div><div class="line"><span class="preprocessor">#define BUFFER_LENGTH     1500</span></div><div class="line"><span class="comment">/* HTML page sent in response to the client */</span></div><div class="line"><span class="preprocessor">#define CAPTIVE_PORTAL_REDIRECT_PAGE \</span></div><div class="line"><span class="preprocessor">&quot;&lt;html&gt;&lt;head&gt;&quot; \</span></div><div class="line"><span class="preprocessor">&quot;Hello, This is a reference HTTP server application&quot; \</span></div><div class="line"><span class="preprocessor">&quot;&lt;/head&gt;&lt;/html&gt;&quot;</span></div><div class="line"></div><div class="line"><a class="code" href="class_h_t_t_p_server.html">HTTPServer</a>             *server;</div><div class="line"><span class="keywordtype">char</span>                   buffer[BUFFER_LENGTH];</div><div class="line"></div><div class="line">int32_t process_handler( <span class="keyword">const</span> <span class="keywordtype">char</span>* url_path, <span class="keyword">const</span> <span class="keywordtype">char</span>* url_parameters, <a class="code" href="structcy__http__response__stream__t.html">cy_http_response_stream_t</a>* stream, <span class="keywordtype">void</span>* arg, <a class="code" href="structcy__http__message__body__t.html">cy_http_message_body_t</a>* http_message_body )</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span>    length = 0;</div><div class="line">    memset(buffer, 0, BUFFER_LENGTH);</div><div class="line">    memcpy( buffer, http_message_body-&gt;<a class="code" href="structcy__http__message__body__t.html#a3d07565cc43cf954e63ebaa5c2db1ca6">data</a>, http_message_body-&gt;<a class="code" href="structcy__http__message__body__t.html#a3cfde2375f1e55e21bd204a8f843f473">data_length</a>);</div><div class="line">    length += http_message_body-&gt;<a class="code" href="structcy__http__message__body__t.html#a3cfde2375f1e55e21bd204a8f843f473">data_length</a>;</div><div class="line">    <span class="keywordflow">if</span> (http_message_body-&gt;<a class="code" href="structcy__http__message__body__t.html#afeaaa983c593be6dc2ba404ea086d44c">data_remaining</a> == 0)</div><div class="line">    {</div><div class="line">        server-&gt;<a class="code" href="class_h_t_t_p_server.html#a1c092569ed367ec082e0c320e1d24979">http_response_stream_write</a>(stream, CAPTIVE_PORTAL_REDIRECT_PAGE, <span class="keyword">sizeof</span>(CAPTIVE_PORTAL_REDIRECT_PAGE));</div><div class="line">        length = 0;</div><div class="line">        memset(buffer, 0, BUFFER_LENGTH);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> snippet_mbed_http_dynamic_reg_resource(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* Status variables for various operations */</span></div><div class="line">    cy_rslt_t TestRes = <a class="code" href="group__http__server__defines.html#gaf18faa0179a6087e4b03d9a81d02010e">CY_RSLT_ERROR</a>;</div><div class="line">    NetworkInterface*      network;</div><div class="line">    cy_network_interface_t nw_interface;</div><div class="line"></div><div class="line">    (void)TestRes;</div><div class="line">    </div><div class="line">    network = NetworkInterface::get_default_instance();</div><div class="line">    network-&gt;connect();</div><div class="line">    nw_interface.object = (<span class="keywordtype">void</span>*) network;</div><div class="line"></div><div class="line">    <span class="comment">/* Create an instance of the HTTP server */</span></div><div class="line">    server = <span class="keyword">new</span> <a class="code" href="class_h_t_t_p_server.html">HTTPServer</a>(&amp;nw_interface, HTTP_PORT, MAX_SOCKETS);</div><div class="line"></div><div class="line">    <span class="comment">/* Register a dynamic resource with the HTTP server */</span></div><div class="line">    <a class="code" href="structcy__resource__dynamic__data__t.html">cy_resource_dynamic_data_t</a> dynamic_resource;</div><div class="line">    dynamic_resource.<a class="code" href="structcy__resource__dynamic__data__t.html#a2fa3f6203db2348184a4cd0409c1d6cb">resource_handler</a> = process_handler;</div><div class="line">    dynamic_resource.<a class="code" href="structcy__resource__dynamic__data__t.html#a21189a067fa29eb836db706aa3553f2b">arg</a> = NULL;</div><div class="line">    TestRes = server-&gt;<a class="code" href="class_h_t_t_p_server.html#a58eb80fb7f039210cc9d7040f0008232">register_resource</a>((uint8_t*) <span class="stringliteral">&quot;/post&quot;</span>, (uint8_t*)<span class="stringliteral">&quot;text/html&quot;</span>, <a class="code" href="group__http__server__struct.html#gga32d601085911dbd59b7ecd50a6b7f584ab61d536399015bfa53ede0e680aae9f7">CY_DYNAMIC_URL_CONTENT</a>, &amp;dynamic_resource);</div><div class="line">    <span class="keywordflow">if</span>(TestRes == CY_RSLT_SUCCESS)</div><div class="line">    {</div><div class="line">        <span class="comment">/* Register dynamic resource completed */</span></div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="snip14"></a>
Code Snippet 5: Registering a Server-Sent Events</h2>
<p>Registers a Server-Sent Events using the register_resource() API function. </p><div class="fragment"><div class="line"><span class="preprocessor">#define HTTP_PORT                80</span></div><div class="line"><span class="preprocessor">#define MAX_SOCKETS              2</span></div><div class="line"><span class="preprocessor">#define CHUNKED_CONTENT_LENGTH   0</span></div><div class="line"></div><div class="line"><a class="code" href="structcy__http__response__stream__t.html">cy_http_response_stream_t</a>      *event_stream ;</div><div class="line"><a class="code" href="class_h_t_t_p_server.html">HTTPServer</a>                     *server_obj;</div><div class="line"></div><div class="line">int32_t snip_mbed_process_SSE_handler( <span class="keyword">const</span> <span class="keywordtype">char</span>* url_path, <span class="keyword">const</span> <span class="keywordtype">char</span>* url_parameters,</div><div class="line">                                       <a class="code" href="structcy__http__response__stream__t.html">cy_http_response_stream_t</a>* stream, <span class="keywordtype">void</span>* arg,</div><div class="line">                                       <a class="code" href="structcy__http__message__body__t.html">cy_http_message_body_t</a>* http_message_body )</div><div class="line">{</div><div class="line">    event_stream = stream;</div><div class="line">    <span class="comment">/* Enable chunked transfer encoding on the HTTP stream */</span></div><div class="line">    server_obj-&gt;<a class="code" href="class_h_t_t_p_server.html#a937e00e6f94294fcdb1aac15c1050a9a">http_response_stream_enable_chunked_transfer</a>( event_stream );</div><div class="line">    server_obj-&gt;<a class="code" href="class_h_t_t_p_server.html#ac16d556a72c51030a4da8b4a959dfe40">http_response_stream_write_header</a>( event_stream, <a class="code" href="group__http__server__struct.html#ggad1b0486d4ab51b5b1969e54aae1e5eddad3dbd9c89c618dff06785fdd77ec0419">CY_HTTP_200_TYPE</a>,</div><div class="line">                                               CHUNKED_CONTENT_LENGTH, <a class="code" href="group__http__server__struct.html#gga64b862dacedd67c3d74845c1a6038b89a21676ce46eff61339e33dded1daeaaea">CY_HTTP_CACHE_DISABLED</a>,</div><div class="line">                                               MIME_TYPE_TEXT_EVENT_STREAM );</div><div class="line">    <span class="comment">/* Disable chunked transfer encoding on the HTTP stream after header write is completed */</span></div><div class="line">    server_obj-&gt;<a class="code" href="class_h_t_t_p_server.html#a72d96603c15870cd4d8a424e7e500c14">http_response_stream_disable_chunked_transfer</a>( event_stream );</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> snippet_mbed_http_server_event_reg(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* Status variables for various operations */</span></div><div class="line">    cy_rslt_t TestRes       = <a class="code" href="group__http__server__defines.html#gaf18faa0179a6087e4b03d9a81d02010e">CY_RSLT_ERROR</a>;</div><div class="line">    NetworkInterface*         network;</div><div class="line">    cy_network_interface_t    nw_interface;</div><div class="line"></div><div class="line">    (void)TestRes;</div><div class="line">    </div><div class="line">    network = NetworkInterface::get_default_instance();</div><div class="line">    network-&gt;connect();</div><div class="line">    nw_interface.object = (<span class="keywordtype">void</span>*) network;</div><div class="line"></div><div class="line">    <span class="comment">/* Create an instance of the HTTP server */</span></div><div class="line">    server_obj = <span class="keyword">new</span> <a class="code" href="class_h_t_t_p_server.html">HTTPServer</a>(&amp;nw_interface, HTTP_PORT, MAX_SOCKETS);</div><div class="line"></div><div class="line">    <a class="code" href="structcy__resource__dynamic__data__t.html">cy_resource_dynamic_data_t</a> dynamic_sse_resource;</div><div class="line">    dynamic_sse_resource.<a class="code" href="structcy__resource__dynamic__data__t.html#a2fa3f6203db2348184a4cd0409c1d6cb">resource_handler</a> = snip_mbed_process_SSE_handler;</div><div class="line">    dynamic_sse_resource.<a class="code" href="structcy__resource__dynamic__data__t.html#a21189a067fa29eb836db706aa3553f2b">arg</a> = NULL;</div><div class="line">    TestRes = server_obj-&gt;<a class="code" href="class_h_t_t_p_server.html#a58eb80fb7f039210cc9d7040f0008232">register_resource</a>((uint8_t*) <span class="stringliteral">&quot;/events&quot;</span>, (uint8_t*)<span class="stringliteral">&quot;text/event-stream&quot;</span>, <a class="code" href="group__http__server__struct.html#gga32d601085911dbd59b7ecd50a6b7f584a6b8d1cd5fef8b7ffc82c06591b8e3bc1">CY_RAW_DYNAMIC_URL_CONTENT</a>, &amp;dynamic_sse_resource);</div><div class="line">    <span class="keywordflow">if</span>(TestRes == CY_RSLT_SUCCESS)</div><div class="line">    {</div><div class="line">        <span class="comment">/* Register dynamic SSE resource completed */</span></div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="snip15"></a>
Code Snippet 6: HTTP server start</h2>
<p>Starts an HTTP server using the start() API function. </p><div class="fragment"><div class="line"><span class="preprocessor">#define HTTP_PORT         80</span></div><div class="line"><span class="preprocessor">#define MAX_SOCKETS       2</span></div><div class="line"></div><div class="line"><span class="comment">/* HTML page sent in response to the client */</span></div><div class="line"><span class="preprocessor">#define CAPTIVE_PORTAL_REDIRECT_PAGE \</span></div><div class="line"><span class="preprocessor">&quot;&lt;html&gt;&lt;head&gt;&quot; \</span></div><div class="line"><span class="preprocessor">&quot;Hello, This is a reference HTTP server application&quot; \</span></div><div class="line"><span class="preprocessor">&quot;&lt;/head&gt;&lt;/html&gt;&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> snippet_mbed_http_server_start(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* Status variables for various operations */</span></div><div class="line">    cy_rslt_t TestRes = <a class="code" href="group__http__server__defines.html#gaf18faa0179a6087e4b03d9a81d02010e">CY_RSLT_ERROR</a>;</div><div class="line">    NetworkInterface*      network;</div><div class="line">    cy_network_interface_t nw_interface;</div><div class="line">    <a class="code" href="class_h_t_t_p_server.html">HTTPServer</a>*            server;</div><div class="line"></div><div class="line">    (void)TestRes;</div><div class="line">    </div><div class="line">    network = NetworkInterface::get_default_instance();</div><div class="line">    network-&gt;connect();</div><div class="line">    nw_interface.object = (<span class="keywordtype">void</span>*) network;</div><div class="line"></div><div class="line">    <span class="comment">/* Create an instance of the HTTP server */</span></div><div class="line">    server = <span class="keyword">new</span> <a class="code" href="class_h_t_t_p_server.html">HTTPServer</a>(&amp;nw_interface, HTTP_PORT, MAX_SOCKETS);</div><div class="line"></div><div class="line">    <span class="comment">/* Register a static resource with then HTTP server */</span></div><div class="line">    <a class="code" href="structcy__resource__static__data__t.html">cy_resource_static_data_t</a> static_resource;</div><div class="line">    static_resource.<a class="code" href="structcy__resource__static__data__t.html#a898a2959797f5d333f70915e27c8f8bf">data</a> = CAPTIVE_PORTAL_REDIRECT_PAGE;</div><div class="line">    static_resource.<a class="code" href="structcy__resource__static__data__t.html#a288d94a277b56b226480d6d18e7787ce">length</a> = <span class="keyword">sizeof</span>( CAPTIVE_PORTAL_REDIRECT_PAGE );</div><div class="line">    TestRes = server-&gt;<a class="code" href="class_h_t_t_p_server.html#a58eb80fb7f039210cc9d7040f0008232">register_resource</a>((uint8_t*) <span class="stringliteral">&quot;/get&quot;</span>, (uint8_t*)<span class="stringliteral">&quot;text/html&quot;</span>, <a class="code" href="group__http__server__struct.html#gga32d601085911dbd59b7ecd50a6b7f584a16c98c125133981542d412c2449988a1">CY_STATIC_URL_CONTENT</a>, &amp;static_resource);</div><div class="line">    <span class="keywordflow">if</span>(TestRes == CY_RSLT_SUCCESS)</div><div class="line">    {</div><div class="line">        <span class="comment">/* Start the HTTP server */</span></div><div class="line">        TestRes = server-&gt;<a class="code" href="class_h_t_t_p_server.html#a5f1e04f9dab07ce5a251ecd4aa822f13">start</a>();</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="snip16"></a>
Code Snippet 7: Sending HTTP server events</h2>
<p>Sends HTTP server events using the http_response_stream_write() API function. </p><div class="fragment"><div class="line"><span class="preprocessor">#define SSE_PAYLOAD            &quot;Hello, This is server sent events \r\n&quot;</span></div><div class="line"><span class="preprocessor">#define LFLF                   &quot;\n\n&quot;</span></div><div class="line"><span class="preprocessor">#define EVENT_STREAM_DATA      &quot;data: &quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define HTTP_PORT              80</span></div><div class="line"><span class="preprocessor">#define MAX_SOCKETS            2</span></div><div class="line"><span class="preprocessor">#define CHUNKED_CONTENT_LENGTH 0</span></div><div class="line"></div><div class="line"><a class="code" href="class_h_t_t_p_server.html">HTTPServer</a>                     *server_object;</div><div class="line"><a class="code" href="structcy__http__response__stream__t.html">cy_http_response_stream_t</a>*     http_event_stream;</div><div class="line"></div><div class="line">int32_t process_SSE_handler( <span class="keyword">const</span> <span class="keywordtype">char</span>* url_path, <span class="keyword">const</span> <span class="keywordtype">char</span>* url_parameters,</div><div class="line">                                           <a class="code" href="structcy__http__response__stream__t.html">cy_http_response_stream_t</a>* stream, <span class="keywordtype">void</span>* arg, </div><div class="line">                                           <a class="code" href="structcy__http__message__body__t.html">cy_http_message_body_t</a>* http_message_body )</div><div class="line">{</div><div class="line">    http_event_stream = stream;</div><div class="line">    server_object-&gt;<a class="code" href="class_h_t_t_p_server.html#a937e00e6f94294fcdb1aac15c1050a9a">http_response_stream_enable_chunked_transfer</a>( http_event_stream );</div><div class="line">    server_object-&gt;<a class="code" href="class_h_t_t_p_server.html#ac16d556a72c51030a4da8b4a959dfe40">http_response_stream_write_header</a>( http_event_stream, <a class="code" href="group__http__server__struct.html#ggad1b0486d4ab51b5b1969e54aae1e5eddad3dbd9c89c618dff06785fdd77ec0419">CY_HTTP_200_TYPE</a>,</div><div class="line">                                               CHUNKED_CONTENT_LENGTH, <a class="code" href="group__http__server__struct.html#gga64b862dacedd67c3d74845c1a6038b89a21676ce46eff61339e33dded1daeaaea">CY_HTTP_CACHE_DISABLED</a>,</div><div class="line">                                               MIME_TYPE_TEXT_EVENT_STREAM );</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> send_events()</div><div class="line">{</div><div class="line">    cy_rslt_t result;</div><div class="line">    <span class="keywordflow">if</span>( http_event_stream == NULL )</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line">    }</div><div class="line">    result = server_object-&gt;<a class="code" href="class_h_t_t_p_server.html#a1c092569ed367ec082e0c320e1d24979">http_response_stream_write</a>( http_event_stream, (<span class="keyword">const</span> <span class="keywordtype">void</span>*)EVENT_STREAM_DATA, <span class="keyword">sizeof</span>( EVENT_STREAM_DATA ) - 1 );</div><div class="line">    <span class="keywordflow">if</span> ( result != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        http_event_stream = NULL;</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line">    }</div><div class="line">    <span class="comment">/* Send the message to the client */</span></div><div class="line">    result = server_object-&gt;<a class="code" href="class_h_t_t_p_server.html#a1c092569ed367ec082e0c320e1d24979">http_response_stream_write</a>( http_event_stream, SSE_PAYLOAD, <span class="keyword">sizeof</span>(SSE_PAYLOAD) - 1);</div><div class="line">    <span class="keywordflow">if</span> ( result != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        http_event_stream = NULL;</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line">    }</div><div class="line">    <span class="comment">/* SSE is ended with two line feeds */</span></div><div class="line">    result = server_object-&gt;<a class="code" href="class_h_t_t_p_server.html#a1c092569ed367ec082e0c320e1d24979">http_response_stream_write</a>( http_event_stream, (<span class="keyword">const</span> <span class="keywordtype">void</span>*)LFLF, <span class="keyword">sizeof</span>( LFLF ) - 1 );</div><div class="line">    <span class="keywordflow">if</span> ( result != CY_RSLT_SUCCESS )</div><div class="line">    {</div><div class="line">        http_event_stream = NULL;</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> snippet_mbed_http_server_send_events(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* Status variables for various operations */</span></div><div class="line">    cy_rslt_t TestRes        = <a class="code" href="group__http__server__defines.html#gaf18faa0179a6087e4b03d9a81d02010e">CY_RSLT_ERROR</a>;</div><div class="line">    NetworkInterface*          network;</div><div class="line">    cy_network_interface_t     nw_interface;</div><div class="line"></div><div class="line">    (void)TestRes;</div><div class="line">    </div><div class="line">    network = NetworkInterface::get_default_instance();</div><div class="line">    network-&gt;connect();</div><div class="line">    nw_interface.object = (<span class="keywordtype">void</span>*) network;</div><div class="line"></div><div class="line">    <span class="comment">/* Create an instance of the HTTP server */</span></div><div class="line">    server_object = <span class="keyword">new</span> <a class="code" href="class_h_t_t_p_server.html">HTTPServer</a>(&amp;nw_interface, HTTP_PORT, MAX_SOCKETS);</div><div class="line"></div><div class="line">    <a class="code" href="structcy__resource__dynamic__data__t.html">cy_resource_dynamic_data_t</a> dynamic_sse_resource;</div><div class="line">    dynamic_sse_resource.<a class="code" href="structcy__resource__dynamic__data__t.html#a2fa3f6203db2348184a4cd0409c1d6cb">resource_handler</a> = process_SSE_handler;</div><div class="line">    dynamic_sse_resource.<a class="code" href="structcy__resource__dynamic__data__t.html#a21189a067fa29eb836db706aa3553f2b">arg</a> = NULL;</div><div class="line">    TestRes = server_object-&gt;<a class="code" href="class_h_t_t_p_server.html#a58eb80fb7f039210cc9d7040f0008232">register_resource</a>((uint8_t*) <span class="stringliteral">&quot;/events&quot;</span>, (uint8_t*)<span class="stringliteral">&quot;text/event-stream&quot;</span>, <a class="code" href="group__http__server__struct.html#gga32d601085911dbd59b7ecd50a6b7f584a6b8d1cd5fef8b7ffc82c06591b8e3bc1">CY_RAW_DYNAMIC_URL_CONTENT</a>, &amp;dynamic_sse_resource);</div><div class="line">    <span class="keywordflow">if</span>(TestRes == CY_RSLT_SUCCESS)</div><div class="line">    {</div><div class="line">        <span class="comment">/* Start the HTTP server */</span></div><div class="line">        TestRes = server-&gt;<a class="code" href="class_h_t_t_p_server.html#a5f1e04f9dab07ce5a251ecd4aa822f13">start</a>();</div><div class="line"></div><div class="line">        <span class="comment">/* Send server events */</span></div><div class="line">        <span class="keywordflow">if</span>( http_event_stream != NULL )</div><div class="line">        {</div><div class="line">            send_events();</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="comment">/* Disconnect event stream */</span></div><div class="line">    TestRes = server-&gt;<a class="code" href="class_h_t_t_p_server.html#ac6f99ff4a888494453553cdced6565b3">http_response_stream_disconnect</a>( http_event_stream );</div><div class="line">    <span class="keywordflow">if</span>(TestRes == CY_RSLT_SUCCESS)</div><div class="line">    {</div><div class="line">        <span class="comment">/* Disconnect given stream completed */</span></div><div class="line">    }</div><div class="line">    <span class="comment">/* Disconnect all stream */</span></div><div class="line">    TestRes = server-&gt;<a class="code" href="class_h_t_t_p_server.html#a73a2c6a64d557e5656541b72f8ceb7a5">http_disconnect_all_response_stream</a>();</div><div class="line">    <span class="keywordflow">if</span>(TestRes == CY_RSLT_SUCCESS)</div><div class="line">    {</div><div class="line">        <span class="comment">/* Disconnect all stream associated with server completed */</span></div><div class="line">    }</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="snip17"></a>
Code Snippet 8: HTTP server stop</h2>
<p>Stops an HTTP server using the stop() API function. </p><div class="fragment"><div class="line"><span class="preprocessor">#define HTTP_PORT         80</span></div><div class="line"><span class="preprocessor">#define MAX_SOCKETS       2</span></div><div class="line"></div><div class="line"><span class="comment">/* HTML page sent in response to the client */</span></div><div class="line"><span class="preprocessor">#define CAPTIVE_PORTAL_REDIRECT_PAGE \</span></div><div class="line"><span class="preprocessor">&quot;&lt;html&gt;&lt;head&gt;&quot; \</span></div><div class="line"><span class="preprocessor">&quot;Hello, This is a reference HTTP server application&quot; \</span></div><div class="line"><span class="preprocessor">&quot;&lt;/head&gt;&lt;/html&gt;&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> snippet_mbed_http_server_stop(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* Status variables for various operations */</span></div><div class="line">    cy_rslt_t TestRes = <a class="code" href="group__http__server__defines.html#gaf18faa0179a6087e4b03d9a81d02010e">CY_RSLT_ERROR</a>;</div><div class="line">    NetworkInterface*      network;</div><div class="line">    cy_network_interface_t nw_interface;</div><div class="line">    <a class="code" href="class_h_t_t_p_server.html">HTTPServer</a>*            server;</div><div class="line"></div><div class="line">    (void)TestRes;</div><div class="line">    </div><div class="line">    network = NetworkInterface::get_default_instance();</div><div class="line">    network-&gt;connect();</div><div class="line">    nw_interface.object = (<span class="keywordtype">void</span>*) network;</div><div class="line"></div><div class="line">    <span class="comment">/* Create an instance of the HTTP server */</span></div><div class="line">    server = <span class="keyword">new</span> <a class="code" href="class_h_t_t_p_server.html">HTTPServer</a>(&amp;nw_interface, HTTP_PORT, MAX_SOCKETS);</div><div class="line"></div><div class="line">    <span class="comment">/* Register a static resource with the HTTP server */</span></div><div class="line">    <a class="code" href="structcy__resource__static__data__t.html">cy_resource_static_data_t</a> static_resource;</div><div class="line">    static_resource.<a class="code" href="structcy__resource__static__data__t.html#a898a2959797f5d333f70915e27c8f8bf">data</a> = CAPTIVE_PORTAL_REDIRECT_PAGE;</div><div class="line">    static_resource.<a class="code" href="structcy__resource__static__data__t.html#a288d94a277b56b226480d6d18e7787ce">length</a> = <span class="keyword">sizeof</span>( CAPTIVE_PORTAL_REDIRECT_PAGE );</div><div class="line">    TestRes = server-&gt;<a class="code" href="class_h_t_t_p_server.html#a58eb80fb7f039210cc9d7040f0008232">register_resource</a>((uint8_t*) <span class="stringliteral">&quot;/get&quot;</span>, (uint8_t*)<span class="stringliteral">&quot;text/html&quot;</span>, <a class="code" href="group__http__server__struct.html#gga32d601085911dbd59b7ecd50a6b7f584a16c98c125133981542d412c2449988a1">CY_STATIC_URL_CONTENT</a>, &amp;static_resource);</div><div class="line">    <span class="keywordflow">if</span>(TestRes == CY_RSLT_SUCCESS)</div><div class="line">    {</div><div class="line">        <span class="comment">/* Start the HTTP server */</span></div><div class="line">        TestRes = server-&gt;<a class="code" href="class_h_t_t_p_server.html#a5f1e04f9dab07ce5a251ecd4aa822f13">start</a>();</div><div class="line">        <span class="comment">/* Stop HTTP server */</span></div><div class="line">        TestRes = server-&gt;<a class="code" href="class_h_t_t_p_server.html#ae4d9963945a344e9f86e7dc74a4e9d6a">stop</a>();</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="snip18"></a>
Code Snippet 9: HTTP URL query</h2>
<p>Search a key-value pair, fetch the value of a key, and get the number of queries from the given URL using URL-processing functions </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> snippet_mbed_http_server_url_query(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* Status variables for various operations */</span></div><div class="line">    cy_rslt_t TestRes = <a class="code" href="group__http__server__defines.html#gaf18faa0179a6087e4b03d9a81d02010e">CY_RSLT_ERROR</a>;</div><div class="line">    NetworkInterface*      network;</div><div class="line">    cy_network_interface_t nw_interface;</div><div class="line">    <a class="code" href="class_h_t_t_p_server.html">HTTPServer</a>*            server;</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> url[] = <span class="stringliteral">&quot;https://example.com/?product=shirt&amp;color=blue&amp;newuser&amp;size=m\n&quot;</span>;</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> key[] = <span class="stringliteral">&quot;product\n&quot;</span>;</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> value[] = <span class="stringliteral">&quot;shirt\n&quot;</span>;</div><div class="line">    <span class="keywordtype">char</span> *value_found = NULL;</div><div class="line">    uint32_t value_length = 0;</div><div class="line">    uint32_t query_param_count = 0;</div><div class="line">    (void)TestRes;</div><div class="line"></div><div class="line">    network = NetworkInterface::get_default_instance();</div><div class="line">    network-&gt;connect();</div><div class="line">    nw_interface.object = (<span class="keywordtype">void</span>*) network;</div><div class="line"></div><div class="line">    <span class="comment">/* Create an instance of the HTTP server */</span></div><div class="line">    server = <span class="keyword">new</span> <a class="code" href="class_h_t_t_p_server.html">HTTPServer</a>(&amp;nw_interface, HTTP_PORT, MAX_SOCKETS);</div><div class="line">    <span class="keywordflow">if</span>( server != NULL )</div><div class="line">    {</div><div class="line">        <span class="comment">/* Check if the provided key-value pair is present in the given URL */</span></div><div class="line">        TestRes = server-&gt;<a class="code" href="class_h_t_t_p_server.html#a90253acc6cd8fcbdf4dd0c42743b26dc">http_match_query_parameter</a>( url, key, value );</div><div class="line">        <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">        {</div><div class="line">            <span class="comment">/* URL query failed */</span></div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">/* Retrieve the value and the length of the value for a given key from the URL */</span></div><div class="line">        TestRes = server-&gt;<a class="code" href="class_h_t_t_p_server.html#a973632c22f7040c30d2a7162c2a3a236">http_get_query_parameter_value</a>( url, key, &amp;value_found, &amp;value_length );</div><div class="line">        <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">        {</div><div class="line">            <span class="comment">/* URL query failed */</span></div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">/* Get number of query parameters found in the URL query string */</span></div><div class="line">        TestRes = server-&gt;<a class="code" href="class_h_t_t_p_server.html#a05965ce0cf59ea53608650ff36a0edb8">http_get_query_parameter_count</a>( url, &amp;query_param_count );</div><div class="line">        <span class="keywordflow">if</span>( TestRes != CY_RSLT_SUCCESS )</div><div class="line">        {</div><div class="line">            <span class="comment">/* URL query failed */</span></div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --></div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>HTTP Server Middleware Library</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
</body>
</html>
